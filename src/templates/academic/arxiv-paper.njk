{# Academic Paper Template (arXiv Style) #}
{%- extends "base/document.njk" -%}

{%- block documentHeader -%}
{%- if arxivId -%}
arXiv:{{ arxivId }} [{{ subject | default("cs.AI") }}] {{ submissionDate | dateFormat | default(currentDate | dateFormat) }}
{%- endif -%}
{%- endblock -%}

{%- block documentTitle -%}
{{ title }}
{%- endblock -%}

{%- block documentSubtitle -%}
{%- if subtitle -%}
{{ subtitle }}
{%- endif -%}
{%- endblock -%}

{%- block authorInfo -%}
{%- for author in authors %}
{{ author.name }}{% if author.affiliation %}^{{ loop.index }}{% endif %}{% if not loop.last %}, {% endif %}
{%- endfor %}

{%- if authors | selectattr("affiliation") | list | length > 0 %}

{%- for author in authors %}
{%- if author.affiliation %}
^{{ loop.index }} {{ author.affiliation }}{% if author.email %} ({{ author.email }}){% endif %}
{%- endif %}
{%- endfor %}
{%- endif %}

{%- if submissionDate %}
Submitted: {{ submissionDate | dateFormat }}
{%- endif %}
{%- if revisionDate %}
Revised: {{ revisionDate | dateFormat }}
{%- endif %}
{%- endblock -%}

{%- block documentBody -%}

{%- if abstract %}
ABSTRACT
========

{{ abstract }}

{%- if keywords %}
**Keywords:** {{ keywords | join(", ") }}
{%- endif %}
{%- endif %}

{%- if sections %}

{%- for section in sections %}

{{ loop.index }}. {{ section.title | upper }}
{{ "=".repeat(section.title | length + 4) }}

{%- if section.content %}
{{ section.content }}
{%- endif %}

{%- if section.subsections %}
{%- for subsection in section.subsections %}

{{ loop.index0 + 1 }}.{{ loop.index }} {{ subsection.title }}
{{ "-".repeat(subsection.title | length + 8) }}

{{ subsection.content }}

{%- if subsection.equations %}
{%- for equation in subsection.equations %}

{{ equation.label }}:
{{ equation.formula }}
{{ equation.description }}

{%- endfor %}
{%- endif %}

{%- if subsection.figures %}
{%- for figure in subsection.figures %}

**Figure {{ figure.number }}:** {{ figure.caption }}
{%- if figure.description %}
{{ figure.description }}
{%- endif %}

{%- endfor %}
{%- endif %}

{%- if subsection.tables %}
{%- for table in subsection.tables %}

**Table {{ table.number }}:** {{ table.caption }}

{%- if table.headers %}
| {{ table.headers | join(" | ") }} |
| {{ table.headers | map("length") | map("range") | map("join", "-") | join(" | ") }} |
{%- endif %}
{%- for row in table.rows %}
| {{ row | join(" | ") }} |
{%- endfor %}

{%- endfor %}
{%- endif %}

{%- endfor %}
{%- endif %}

{%- endfor %}
{%- endif %}

{%- if experiments %}

EXPERIMENTAL RESULTS
====================

{%- for experiment in experiments %}

{{ loop.index }}.{{ loop.index }} {{ experiment.name }}
{{ "-".repeat(experiment.name | length + 8) }}

{%- if experiment.setup %}
**Setup:** {{ experiment.setup }}
{%- endif %}

{%- if experiment.results %}
**Results:** {{ experiment.results }}
{%- endif %}

{%- if experiment.metrics %}
**Metrics:**
{%- for metric in experiment.metrics %}
- {{ metric.name }}: {{ metric.value }}{% if metric.unit %} {{ metric.unit }}{% endif %}
{%- endfor %}
{%- endif %}

{%- if experiment.analysis %}
**Analysis:** {{ experiment.analysis }}
{%- endif %}

{%- endfor %}
{%- endif %}

{%- if conclusion %}

CONCLUSION
==========

{{ conclusion }}

{%- if futureWork %}

**Future Work:** {{ futureWork }}
{%- endif %}
{%- endif %}

{%- if acknowledgments %}

ACKNOWLEDGMENTS
===============

{{ acknowledgments }}
{%- endif %}

{%- if references %}

REFERENCES
==========

{%- for ref in references %}
[{{ loop.index }}] {% if ref.authors %}{{ ref.authors | join(", ") }}. {% endif %}"{{ ref.title }}"{% if ref.journal %}, *{{ ref.journal }}*{% endif %}{% if ref.volume %}, vol. {{ ref.volume }}{% endif %}{% if ref.pages %}, pp. {{ ref.pages }}{% endif %}{% if ref.year %}, {{ ref.year }}{% endif %}{% if ref.doi %}. DOI: {{ ref.doi }}{% endif %}{% if ref.url %}. Available: {{ ref.url }}{% endif %}.
{%- endfor %}
{%- endif %}

{%- endblock -%}

{%- block appendix -%}
{%- if appendices %}

{%- for appendix in appendices %}

APPENDIX {{ "ABCDEFGHIJKLMNOPQRSTUVWXYZ"[loop.index0] }}: {{ appendix.title | upper }}
{{ "=".repeat(appendix.title | length + 12) }}

{{ appendix.content }}

{%- if appendix.code %}

**Code Listing:**
```
{{ appendix.code }}
```
{%- endif %}

{%- if appendix.data %}

**Data:**
{%- for item in appendix.data %}
{{ item }}
{%- endfor %}
{%- endif %}

{%- endfor %}
{%- endif %}
{%- endblock -%}

{%- block documentFooter -%}
{%- if includeFooter !== false -%}

---
Generated by {{ templateEngine }}
{%- if wordCount %}
Word Count: Approximately {{ abstract ~ sections | map("content") | join(" ") | wordCount }} words
{%- endif %}
{%- if arxivCategory %}
arXiv Category: {{ arxivCategory }}
{%- endif %}
{%- if license %}
License: {{ license }}
{%- endif %}
{%- endif -%}
{%- endblock -%}