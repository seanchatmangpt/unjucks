@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix schema: <http://schema.org/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix kgen: <http://kgen.org/security/shapes/> .

# =============================================================================
# KGEN Security Rule Pack
# SHACL shapes for enforcing security and privacy standards
# =============================================================================

# Secure URI Patterns
kgen:SecureURIShape
    a sh:NodeShape ;
    sh:targetNode sh:IRI ;
    sh:not [
        sh:pattern "^(ftp|telnet|file)://" ;
    ] ;
    sh:severity sh:Violation ;
    sh:message "URIs must not use insecure protocols (ftp, telnet, file) - Security Rule" .

# Personal Data Protection
kgen:PersonalDataProtectionShape
    a sh:NodeShape ;
    sh:targetClass schema:Person ;
    sh:property [
        sh:path schema:socialSecurityNumber ;
        sh:maxCount 0 ;
        sh:severity sh:Violation ;
        sh:message "Social Security Numbers must not be stored in RDF (Privacy Rule)"
    ] ;
    sh:property [
        sh:path schema:creditCard ;
        sh:maxCount 0 ;
        sh:severity sh:Violation ;
        sh:message "Credit Card information must not be stored in RDF (Security Rule)"
    ] .

# Data Classification Rules
kgen:DataClassificationShape
    a sh:NodeShape ;
    sh:targetClass schema:Thing ;
    sh:property [
        sh:path kgen:dataClassification ;
        sh:in ("public" "internal" "confidential" "restricted") ;
        sh:severity sh:Warning ;
        sh:message "Data should have proper classification (Security Rule)"
    ] .

# Access Control Rules
kgen:AccessControlShape
    a sh:NodeShape ;
    sh:targetClass schema:Thing ;
    sh:property [
        sh:path kgen:accessLevel ;
        sh:in ("public" "authenticated" "authorized" "admin") ;
        sh:severity sh:Info ;
        sh:message "Entities should specify access level (Security Rule)"
    ] .

# Audit Trail Requirements
kgen:AuditTrailShape
    a sh:NodeShape ;
    sh:targetClass schema:Thing ;
    sh:property [
        sh:path dct:creator ;
        sh:minCount 1 ;
        sh:severity sh:Warning ;
        sh:message "All entities should have creator information for audit trail (Security Rule)"
    ] ;
    sh:property [
        sh:path kgen:lastModifiedBy ;
        sh:maxCount 1 ;
        sh:severity sh:Info ;
        sh:message "Entities should track last modifier (Audit Rule)"
    ] .

# Content Security Rules
kgen:ContentSecurityShape
    a sh:NodeShape ;
    sh:targetClass schema:Thing ;
    sh:property [
        sh:path schema:description ;
        sh:not [
            sh:pattern "(?i).*(script|iframe|object|embed|javascript).*" ;
        ] ;
        sh:severity sh:Violation ;
        sh:message "Descriptions must not contain potentially dangerous HTML/JavaScript (XSS Prevention)"
    ] ;
    sh:property [
        sh:path schema:name ;
        sh:not [
            sh:pattern ".*[<>\"'&].*" ;
        ] ;
        sh:severity sh:Warning ;
        sh:message "Names should not contain HTML-sensitive characters (XSS Prevention)"
    ] .