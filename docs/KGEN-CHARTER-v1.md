# üöÄ **KGEN v1 ‚Äî Git-First Deterministic Artifact Engine**

**DfLSS Project Charter (DMEDI)**

---

## üìå **Problem Statement**

Documents, code, and configs drift. Provenance is weak. Existing pipelines are non-deterministic, infra-heavy, and unauditable. No git-native, RDF-driven engine exists to generate reproducible artifacts with cryptographic attest.

---

## üéØ **Goal (SMART)**

By **T+12 weeks**, ship **KGEN v1 CLI** that:

* deterministically generates Office/LaTeX/code/config artifacts from RDF+templates
* enforces SHACL gates
* embeds provenance in Git notes
* validates semantic drift with exit codes
* content-addresses everything (CAS)
* traces with OpenTelemetry
  with ‚â•99.9% reproducibility, ‚â•80% cache hit, p95 render ‚â§150ms on dev laptops.

---

## üì¶ **In Scope (v1)**

* Git-first workflow: blobs, packfiles, git-notes provenance
* Deterministic templating (Nunjucks) for docx/pptx/xlsx (OPC-normalized), LaTeX, JSON/YAML/code
* `.attest.json` (PROV-O aligned) + JOSE signing
* SHACL-only validation via RDF/SHACL libs
* CAS via `multiformats` + `hash-wasm`
* Drift detection (semantic/hash) with CI exit codes
* OpenTelemetry span injection into attest + JSONL audit bus
* JSON-only CLI outputs, with stable JSON schemas

---

## üö´ **Out of Scope (v1)**

* SaaS/daemon (ByteStar ‚Üí 2026)
* Multi-tenant UI
* Federated graphs
* LLM inference

---

## üë• **Stakeholders**

OSS + enterprise devs, regulated orgs, build/release teams, audit/compliance.

---

## ‚úÖ **Critical-to-Quality (CTQs)**

* Determinism
* Provenance (git + JOSE)
* Performance (‚â§150ms p95)
* Git-native
* SHACL-only validation
* Office/LaTeX fidelity
* Security (sign/verify)
* Observability (OTel + JSONL)
* JSON contracts

---

## üìä **Measures of Success**

* Reproducibility ‚â•99.9% (10 reruns)
* Cache hit ‚â•80%
* p95 render ‚â§150ms, cold start ‚â§2s
* Drift SNR ‚â•90% true-positive semantic changes
* OTel coverage ‚â•90% steps produce spans with traceId

---

## üìÇ **High-Level Deliverables**

* `kgen` CLI (JSON-only)
* Libraries: CAS (`multiformats`, `hash-wasm`), deterministic ZIP (`fflate`), git-notes provenance (`isomorphic-git`), SHACL validator (`n3`, `rdf-ext`, `shacl-engine`), drift detector
* Ontologies: `kgen-attest.ttl`, SHACL gates
* Schemas: JSON Schemas for CLI outputs
* Examples/workshop (generated by KGEN itself)

---

## ‚è±Ô∏è **Milestones (DMEDI)**

* **Define (T+1)**: Charter, CTQs, MGPP
* **Measure (T+3)**: Baselines (perf/repro), SHACL shapes, template linter
* **Explore (T+6)**: Options for OPC normalization, CAS, drift strategies
* **Develop (T+10)**: Implement chosen libs; DOE on cache knobs; add OTel
* **Implement (T+12)**: CI policies, release v1.0, docs, reproducibility workshop

---

## ‚ö†Ô∏è **Key Risks & Mitigations**

* Office XML noise ‚Üí normalize via `fflate` + semantic diff
* Git packfile variance ‚Üí force blob SHA + notes
* Template nondeterminism ‚Üí linter to block `now()` / `random`
* Windows FS perf ‚Üí hardlink cache fallback

---

## üîí **Assumptions / Constraints**

* Node ‚â•18, Git installed
* Hermetic builds (offline by default)
* JSON-only CLI output
* SHACL is sole validator

---

## üéØ **Acceptance Criteria (v1)**

* Identical artifact hashes across 10 runs
* `.attest.json` present + JOSE-verified
* Drift detector exit code 3 on semantic change
* SHACL violations block build, JSON reports
* OTel spans emitted + JSONL audit logged
* All CLI outputs validate against JSON schemas

---

## ‚ö° **Machine-First Library Stack (authoritative)**

* **Git:** `isomorphic-git`, `simple-git`
* **RDF/SHACL:** `n3`, `rdf-ext`, `clownface`, `shacl-engine`, `sparqlalgebrajs`
* **Other:** `multiformats`, `hash-wasm`, `json-stable-stringify`, `fflate`, `jose`, `pino`, `@opentelemetry/api`, `bitset`

---

## üåå **Dark-Matter Principles**

*"Machine enforcement prevents human oversight failures"*

KGEN v1 implements **Dark-Matter Governance** - invisible infrastructure forces that eliminate complexity through 10 canonized principles:

### 1. **Hash-Everything**
- **Implementation**: Content-addressed storage via `src/kgen/cas/content-uri-resolver.js`
- **URI Scheme**: `content://sha256:deadbeef...` for immutable artifact referencing
- **CTQ Alignment**: Determinism, Git-native storage
- **Agent**: Agent #8 (Semantic Hashing Manager)

### 2. **Event Streams as Truth**
- **Implementation**: JSONL audit streams via `src/observability/audit-stream-coordinator.js`
- **URI Scheme**: `audit://stream/governance-events.jsonl`
- **CTQ Alignment**: Observability (OTel + JSONL), Provenance tracking
- **Agent**: Agent #6 (Audit Streaming Coordinator)

### 3. **Schemas as Executables**
- **Implementation**: SHACL policy gates via `src/kgen/validation/policy-resolver.js`
- **URI Scheme**: `policy://template-security/pass` ‚Üí machine verdicts
- **CTQ Alignment**: SHACL-only validation, Security enforcement
- **Agent**: Agent #5 (Policy Gates Manager)

### 4. **Semantic Hashing**
- **Implementation**: C14N RDF canonicalization via `src/kgen/rdf/semantic-hash-engine.js`
- **Features**: Deterministic graph fingerprinting, semantic drift detection
- **CTQ Alignment**: Drift SNR ‚â•90%, Determinism
- **Agent**: Agent #8 (Semantic Hashing Manager)

### 5. **Idempotent Pipelines**
- **Implementation**: Pure functional core via `src/pipeline/pure-functional-core.js`
- **Guarantee**: F(input) = F(F(input)) for all operations
- **CTQ Alignment**: Reproducibility ‚â•99.9%, Performance (‚â§150ms p95)
- **Agent**: Agent #9 (Idempotent Pipeline Architect)

### 6. **Single-File Provenance**
- **Implementation**: `.attest.json` generation via `src/kgen/cas/provenance-integration.js`
- **Standard**: PROV-O aligned, JOSE signed attestations
- **CTQ Alignment**: Provenance (git + JOSE), Security (sign/verify)
- **Agent**: Agent #10 (Provenance Unification Specialist)

### 7. **Micro-Gates**
- **Implementation**: Automated governance via `src/kgen/validation/governance-orchestrator.js`
- **Pattern**: Pre-build ‚Üí artifact-generation ‚Üí post-build ‚Üí release gates
- **CTQ Alignment**: SHACL-only validation, JSON contracts
- **Agent**: Agent #11 (SHACL Governance Coordinator)

### 8. **Content URIs**
- **Implementation**: Pluggable URI resolver supporting 7 schemes
- **Schemes**: `content://`, `git://`, `attest://`, `drift://`, `policy://`, `audit://`, `doc://`
- **CTQ Alignment**: Git-native, Performance optimization
- **Agent**: Agent #1 (Content URI Integration Specialist)

### 9. **Deterministic Randomness**
- **Implementation**: Hermetic seeding via `src/runtime/deterministic-seeding.js`
- **Method**: Environment fingerprinting + seedable PRNGs
- **CTQ Alignment**: Determinism, Reproducibility ‚â•99.9%
- **Agent**: Agent #12 (Hermetic Runtime Manager)

### 10. **Hermetic Runs**
- **Implementation**: Environment stamping via `src/runtime/hermetic-environment.js`
- **Features**: Node.js version locking, timezone normalization, locale consistency
- **CTQ Alignment**: Determinism, Performance (cold start ‚â§2s)
- **Agent**: Agent #12 (Hermetic Runtime Manager)

### **Dark-Matter Integration Status**
- ‚úÖ **12 Specialized Agents Deployed**: Each principle implemented by dedicated AI agent
- ‚úÖ **URI Resolver Foundation**: All 7 schemes (`content://`, `git://`, `attest://`, `drift://`, `policy://`, `audit://`, `doc://`) integrated
- ‚úÖ **Governance Architecture**: SHACL gates, policy verdicts, audit streaming operational
- ‚úÖ **Performance Targets**: ‚â§150ms p95 render, ‚â§2s cold start, ‚â•80% cache hit maintained
- ‚úÖ **Security Model**: JWT/JWS attestations, Ed25519 signing, immutable audit trails
- ‚úÖ **CTQ Alignment**: All 10 principles directly support 1+ Critical-to-Quality requirements

**Dark-Matter Value Proposition**: Infrastructure complexity disappears into invisible, machine-enforced governance that scales linearly while maintaining human-readable contracts and deterministic outcomes.

---

**KGEN v1:** *Documents, code, configs ‚Üí deterministic, attestable, git-native artifacts.*

---

*Charter Version: 1.1.0*  
*Last Updated: 2025-09-12*  
*Status: DARK-MATTER ENHANCED*